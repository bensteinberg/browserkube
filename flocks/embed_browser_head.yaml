name: embed_browser_head

volumes:
  tmpdir: '/tmp/.X11-unix'
  webarchive: '/webarchive' 

containers:
  - name: pywb
    image: embedsarchive_pywb
    environment:
      INIT_COLLECTION: capture

  - name: xserver
    image: oldwebtoday/vnc-webrtc-audio
    external_network: '${BROWSER_NET}'
    ports:
      vnc_port: 6080
      cmd_port: 6082
      ice_tcp_port: 10235
      ice_udp_port: '10235/udp'

    environment:
      IDLE_TIMEOUT: '${IDLE_TIMEOUT}'
      WEBRTC_TURN_REST_AUTH_SECRET: '${WEBRTC_TURN_REST_AUTH_SECRET}'
      WEBRTC_TURN_REALM: '${WEBRTC_TURN_REALM}'
      WEBRTC_VIDEO: '1'   # Comment for audio only
      WEBRTC_STUN_SERVER: '${WEBRTC_STUN_SERVER}'

  - name: browser
    image: oldwebtoday/base-browser
    image_label: wr.name
    set_user_params: true

    environment:
      DISPLAY: ':99'
      PULSE_SERVER: '/tmp/.X11-unix/pulse-socket'

      PROXY_HOST: 'pywb'
      PROXY_PORT: '8080'
      PROXY_CA_URL: 'http://wsgiprox/download/pem'
      PROXY_CA_FILE: '/tmp/proxy-ca.pem'

  - name: embedserver
    image: embedsarchive_driver
    external_network: '${BROWSER_NET}'
    environment:
      BROWSER_HOST: browser
      EMBED_HOST: embedserver
